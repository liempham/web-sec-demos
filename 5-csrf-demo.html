<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i h·ªçc v·ªÅ CSRF</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            scroll-behavior: smooth
        }

        .section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
            box-sizing: border-box;
            min-height: 100vh
        }

        .container {
            width: 100%;
            max-width: 650px;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1)
        }

        h1 {
            font-size: clamp(2em, 8vw, 3em);
            margin-bottom: 20px;
            color: #333
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-top: 40px
        }

        ul {
            text-align: left;
            padding-left: 25px
        }

        p,
        li {
            font-size: clamp(1em, 4vw, 1.2em);
            line-height: 1.6;
            margin-bottom: 15px;
            color: #555
        }

        .site-box {
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            margin-bottom: 20px
        }

        .site-box h3 {
            margin-top: 0;
            color: #4a90e2
        }

        .site-box-malicious h3 {
            color: #c94a4a
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: 600;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color .3s ease;
            width: 100%
        }

        .info-display {
            background-color: #eee;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            font-family: 'Courier New', Courier, monospace
        }

        #maliciousBtn {
            background-color: #c94a4a
        }

        .mermaid-container {
            width: 100%;
            margin-top: 30px
        }

        @media (min-width:992px) {
            .container {
                max-width: 900px
            }

            .mermaid-container {
                margin-top: 40px
            }
        }
    </style>
</head>

<body>
    <div class="section">
        <div class="container">
            <h1>üé≠ Th·ª≠ nghi·ªám Cross-Site Request Forgery (CSRF) üé≠</h1>
            <p>Demo n√†y m√¥ ph·ªèng hai trang web: m·ªôt trang m·∫°ng x√£ h·ªôi b·∫°n ƒë√£ ƒëƒÉng nh·∫≠p v√† m·ªôt trang web ƒë·ªôc h·∫°i.</p>
            <div class="site-box">
                <h3>Trang M·∫°ng x√£ h·ªôi (<code>mangxahoi.com</code>)</h3>
                <p>B·∫°n ƒë√£ ƒëƒÉng nh·∫≠p. Tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa b·∫°n l√†:</p>
                <div id="statusDisplay" class="info-display">"H√¥m nay tr·ªùi ƒë·∫πp qu√°!"</div>
            </div>
            <div class="site-box site-box-malicious">
                <h3>Trang web ƒë·ªôc h·∫°i (<code>trangwebgianlan.com</code>)</h3>
                <p>Trang n√†y c√≥ m·ªôt n√∫t b·∫•m tr√¥ng r·∫•t h·∫•p d·∫´n. H√£y nh·∫•n v√†o n√≥ ƒë·ªÉ xem ƒëi·ªÅu g√¨ x·∫£y ra v·ªõi tr·∫°ng th√°i c·ªßa
                    b·∫°n!</p>
                <button id="maliciousBtn">Nh·∫≠n qu√† mi·ªÖn ph√≠!</button>
                <form id="csrf-form" action="https://mangxahoi.com/update-status" method="POST" target="hidden-iframe"
                    style="display:none;"><input type="text" name="new_status" value="T√†i kho·∫£n c·ªßa t√¥i ƒë√£ b·ªã hack!">
                </form><iframe name="hidden-iframe" style="display:none;"></iframe>
            </div>
            <h2>L·ªói CSRF l√† g√¨?</h2>
            <p>L·ªói n√†y l·ª´a tr√¨nh duy·ªát c·ªßa m·ªôt n·∫°n nh√¢n (ƒëang ƒëƒÉng nh·∫≠p) g·ª≠i ƒëi m·ªôt y√™u c·∫ßu gi·∫£ m·∫°o ƒë·∫øn m·ªôt trang web
                ƒë√°ng tin c·∫≠y. V√¨ tr√¨nh duy·ªát t·ª± ƒë·ªông g·ª≠i k√®m cookie x√°c th·ª±c, trang web ƒë√°ng tin c·∫≠y nghƒ© r·∫±ng y√™u c·∫ßu
                ƒë√≥ l√† h·ª£p l·ªá v√† th·ª±c hi·ªán h√†nh ƒë·ªông (v√≠ d·ª•: ƒë·ªïi m·∫≠t kh·∫©u, chuy·ªÉn ti·ªÅn) m√† ng∆∞·ªùi d√πng kh√¥ng h·ªÅ hay bi·∫øt.
            </p>
            <h2>L√†m th·∫ø n√†o ƒë·ªÉ kh·∫Øc ph·ª•c?</h2>
            <ul>
                <li><strong>S·ª≠ d·ª•ng Anti-CSRF Tokens:</strong> ƒê√¢y l√† ph∆∞∆°ng ph√°p ph·ªï bi·∫øn v√† hi·ªáu qu·∫£ nh·∫•t. V·ªõi m·ªói
                    phi√™n l√†m vi·ªác, m√°y ch·ªß t·∫°o ra m·ªôt m√£ b√≠ m·∫≠t, ng·∫´u nhi√™n (token) v√† nh√∫ng n√≥ v√†o c√°c form. Khi ng∆∞·ªùi
                    d√πng g·ª≠i form, token n√†y c≈©ng ƒë∆∞·ª£c g·ª≠i theo. M√°y ch·ªß s·∫Ω ki·ªÉm tra xem token nh·∫≠n v·ªÅ c√≥ kh·ªõp v·ªõi token
                    ƒë√£ t·∫°o ra kh√¥ng. V√¨ trang c·ªßa k·∫ª t·∫•n c√¥ng kh√¥ng th·ªÉ bi·∫øt ƒë∆∞·ª£c token n√†y, y√™u c·∫ßu gi·∫£ m·∫°o s·∫Ω b·ªã t·ª´
                    ch·ªëi.</li>
                <li><strong>S·ª≠ d·ª•ng SameSite Cookie Attribute:</strong> C·∫•u h√¨nh cookie v·ªõi thu·ªôc t√≠nh `SameSite=Strict`
                    ho·∫∑c `SameSite=Lax`. Vi·ªác n√†y ch·ªâ th·ªã cho tr√¨nh duy·ªát kh√¥ng g·ª≠i cookie trong c√°c y√™u c·∫ßu cross-site
                    (y√™u c·∫ßu xu·∫•t ph√°t t·ª´ m·ªôt t√™n mi·ªÅn kh√°c), qua ƒë√≥ v√¥ hi·ªáu h√≥a t·∫•n c√¥ng CSRF trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng
                    h·ª£p.</li>
            </ul>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant Victim as NanNhan
                    participant Browser as TrinhDuyet
                    participant TrustedSite as mangxahoi.com
                    participant MaliciousSite as trangwebgianlan.com

                    Victim->>TrustedSite: 1. Dang nhap
                    TrustedSite-->>Browser: Luu cookie phien lam viec
                    Victim->>MaliciousSite: 2. Truy cap vao trang doc hai
                    Victim->>MaliciousSite: 3. Nhan nut "Nhan qua"
                    MaliciousSite-->>Browser: 4. Ra lenh gui yeu cau gia mao<br />den mangxahoi.com
                    Note right of Browser: Trinh duyet tu dong dinh kem<br />cookie cua mangxahoi.com!
                    Browser->>TrustedSite: 5. Gui yeu cau thay doi trang thai<br />(da duoc xac thuc bang cookie)
                    TrustedSite-->>TrustedSite: 6. LOI: Chi kiem tra cookie,<br />khong kiem tra Anti-CSRF token.<br />Yeu cau duoc chap nhan!
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentUserStatus = "H√¥m nay tr·ªùi ƒë·∫πp qu√°!"; const statusDisplay = document.getElementById("statusDisplay"), maliciousBtn = document.getElementById("maliciousBtn"), csrfForm = document.getElementById("csrf-form"); let isLoggedIn = !0; maliciousBtn.addEventListener("click", () => { if (isLoggedIn) { alert("B·∫°n ƒë√£ nh·∫•n n√∫t tr√™n trang ƒë·ªôc h·∫°i! H√£y xem tr·∫°ng th√°i c·ªßa b·∫°n ƒë√£ b·ªã thay ƒë·ªïi."); const formData = new FormData(csrfForm), newStatus = formData.get("new_status"); currentUserStatus = newStatus; statusDisplay.textContent = `"${currentUserStatus}"`; statusDisplay.style.color = "#c94a4a"; statusDisplay.style.borderColor = "#c94a4a" } });
    </script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'base' });
    </script>
</body>

</html>